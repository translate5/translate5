import splitNode from './split-node.js';

describe('splitNode', () => {
    test('cut text node in the middle', () => {
        const text = document.createTextNode('Hello');
        const [left, right] = splitNode(text, 2);
        expect(left.nodeType).toBe(Node.TEXT_NODE);
        expect(right.nodeType).toBe(Node.TEXT_NODE);
        expect(left.data).toBe('He');
        expect(right.data).toBe('llo');
    });

    test('insertion containing only tags is split in the middle', () => {
        document.body.innerHTML = `<ins class="trackchanges ownttip" data-usertrackingid="67914" data-usercssnr="usernr1" data-workflowstep="firsttranslation1" data-timestamp="2025-09-01T11:38:45+02:00"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;3/&amp;gt;%3C/text%3E%3C/svg%3E" alt="…" id="tag-image-internal-tag single3" title="…" data-length="-1" data-pixellength="0" data-tag-number="3"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2226%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E-40%3C/text%3E%3C/svg%3E" alt="-40" id="tag-image-internal-tag single6" title="&lt;6/&gt; CP: default simple" data-length="3" data-pixellength="0" data-tag-number="6"></ins>`;
        const div = document.querySelector('ins');
        const [left, right] = splitNode(div, 1);
        expect(left.outerHTML).toBe("<ins class=\"trackchanges ownttip\" data-usertrackingid=\"67914\" data-usercssnr=\"usernr1\" data-workflowstep=\"firsttranslation1\" data-timestamp=\"2025-09-01T11:38:45+02:00\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;3/&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"…\" id=\"tag-image-internal-tag single3\" title=\"…\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"3\"></ins>");
        expect(right.outerHTML).toBe("<ins class=\"trackchanges ownttip\" data-usertrackingid=\"67914\" data-usercssnr=\"usernr1\" data-workflowstep=\"firsttranslation1\" data-timestamp=\"2025-09-01T11:38:45+02:00\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2226%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E-40%3C/text%3E%3C/svg%3E\" alt=\"-40\" id=\"tag-image-internal-tag single6\" title=\"<6/> CP: default simple\" data-length=\"3\" data-pixellength=\"0\" data-tag-number=\"6\"></ins>");
    });

    test('spellcheck containing only tags is split in the at first', () => {
        document.body.innerHTML = `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="8" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error."><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open6" title="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open8" title="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="8"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E" alt="DGC-...-GF/-KF/-FA" id="tag-image-internal-tag single7" title="DGC-...-GF/-KF/-FA" data-length="-1" data-pixellength="0" data-tag-number="7"><img class="internal-tag close" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" id="tag-image-internal-tag close6" title="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"> </span>`;
        const div = document.querySelector('span');
        const [left, right] = splitNode(div, 1);
        expect(left.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open6\" title=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"></span>");
        expect(right.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open8\" title=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"8\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"DGC-...-GF/-KF/-FA\" id=\"tag-image-internal-tag single7\" title=\"DGC-...-GF/-KF/-FA\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"7\"><img class=\"internal-tag close\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" id=\"tag-image-internal-tag close6\" title=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"> </span>");
    });

    test('spellcheck containing only tags is split at second', () => {
        document.body.innerHTML = `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="8" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error."><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open6" title="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open8" title="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="8"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E" alt="DGC-...-GF/-KF/-FA" id="tag-image-internal-tag single7" title="DGC-...-GF/-KF/-FA" data-length="-1" data-pixellength="0" data-tag-number="7"><img class="internal-tag close" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" id="tag-image-internal-tag close6" title="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"> </span>`;
        const div = document.querySelector('span');
        const [left, right] = splitNode(div, 2);
        expect(left.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open6\" title=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open8\" title=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"8\"></span>");
        expect(right.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"DGC-...-GF/-KF/-FA\" id=\"tag-image-internal-tag single7\" title=\"DGC-...-GF/-KF/-FA\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"7\"><img class=\"internal-tag close\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" id=\"tag-image-internal-tag close6\" title=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"> </span>");
    });

    test('spellcheck containing only tags is split at third', () => {
        document.body.innerHTML = `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="8" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error."><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open6" title="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open8" title="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="8"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E" alt="DGC-...-GF/-KF/-FA" id="tag-image-internal-tag single7" title="DGC-...-GF/-KF/-FA" data-length="-1" data-pixellength="0" data-tag-number="7"><img class="internal-tag close" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" id="tag-image-internal-tag close6" title="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"> </span>`;
        const div = document.querySelector('span');
        const [left, right] = splitNode(div, 3);
        expect(left.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open6\" title=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open8\" title=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"8\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"DGC-...-GF/-KF/-FA\" id=\"tag-image-internal-tag single7\" title=\"DGC-...-GF/-KF/-FA\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"7\"></span>");
        expect(right.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag close\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" id=\"tag-image-internal-tag close6\" title=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"> </span>");
    });

    test('spellcheck containing only tags is split at fourth', () => {
        document.body.innerHTML = `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="8" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error."><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open6" title="&lt;bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"><img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" id="tag-image-internal-tag open8" title="&lt;bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;&gt;&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;&lt;/bpt&gt;" data-length="-1" data-pixellength="0" data-tag-number="8"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E" alt="DGC-...-GF/-KF/-FA" id="tag-image-internal-tag single7" title="DGC-...-GF/-KF/-FA" data-length="-1" data-pixellength="0" data-tag-number="7"><img class="internal-tag close" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" id="tag-image-internal-tag close6" title="&lt;ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;&lt;/ept&gt;" data-length="-1" data-pixellength="0" data-tag-number="6"> </span>`;
        const div = document.querySelector('span');
        const [left, right] = splitNode(div, 4);
        expect(left.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open6\" title=\"<bpt id=&quot;6&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_5d541fd9f029c45bd55f8914241227f1&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"><img class=\"internal-tag open\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;8&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" id=\"tag-image-internal-tag open8\" title=\"<bpt id=&quot;8&quot; ctype=&quot;x-dnt&quot;>&amp;lt;dnt y.commentable=&amp;quot;true&amp;quot; y.id=&amp;quot;ID_4b0a39baf029c45bd55f89143e651182&amp;quot; y.linktarget=&amp;quot;true&amp;quot;&amp;gt;</bpt>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"8\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;7/&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"DGC-...-GF/-KF/-FA\" id=\"tag-image-internal-tag single7\" title=\"DGC-...-GF/-KF/-FA\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"7\"><img class=\"internal-tag close\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/6&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" id=\"tag-image-internal-tag close6\" title=\"<ept id=&quot;6&quot;>&amp;lt;/dnt&amp;gt;</ept>\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"6\"></span>");
        expect(right.outerHTML).toBe("<span class=\"t5spellcheck t5misspelling ownttip\" data-spellcheck-activematchindex=\"8\" data-qtip=\"<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.\"> </span>");
    });

    test('position is out of bounds', () => {
        document.body.innerHTML = `<ins class="trackchanges ownttip" data-usertrackingid="67914" data-usercssnr="usernr1" data-workflowstep="firsttranslation1" data-timestamp="2025-09-01T11:38:45+02:00"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;3/&amp;gt;%3C/text%3E%3C/svg%3E" alt="…" id="tag-image-internal-tag single3" title="…" data-length="-1" data-pixellength="0" data-tag-number="3"><img class="internal-tag single" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2226%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E-40%3C/text%3E%3C/svg%3E" alt="-40" id="tag-image-internal-tag single6" title="&lt;6/&gt; CP: default simple" data-length="3" data-pixellength="0" data-tag-number="6"></ins>`;
        const div = document.querySelector('ins');
        const [left, right] = splitNode(div, 100);
        expect(left.outerHTML).toBe("<ins class=\"trackchanges ownttip\" data-usertrackingid=\"67914\" data-usercssnr=\"usernr1\" data-workflowstep=\"firsttranslation1\" data-timestamp=\"2025-09-01T11:38:45+02:00\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;3/&amp;gt;%3C/text%3E%3C/svg%3E\" alt=\"…\" id=\"tag-image-internal-tag single3\" title=\"…\" data-length=\"-1\" data-pixellength=\"0\" data-tag-number=\"3\"><img class=\"internal-tag single\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2226%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22\\'Open%20Sans\\',%20\\'Helvetica%20Neue\\',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E-40%3C/text%3E%3C/svg%3E\" alt=\"-40\" id=\"tag-image-internal-tag single6\" title=\"<6/> CP: default simple\" data-length=\"3\" data-pixellength=\"0\" data-tag-number=\"6\"></ins>");
        expect(right).toBe(null);
    });

    test('insertion with mixed content - text and tags', () => {
        document.body.innerHTML = `<ins class="trackchanges ownttip" data-usertrackingid="3786" data-usercssnr="usernr1" data-workflowstep="no workflow1" data-timestamp="2025-08-27T12:56:05+03:00">` +
            `<img class="internal-tag single whitespace newline" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2210%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%B5%3C/text%3E%3C/svg%3E" alt="↵" id="tag-image-whitespace2" title="&lt;2/&gt;: Newline" data-length="1" data-pixellength="0" data-tag-number="2">` +
            `Wi` +
            `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="1" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">e S</span>` +
            `ie ` +
            `<img class="internal-tag single whitespace" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%22208%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%3C/text%3E%3C/svg%3E" alt="→→→→→→→→→→→→" id="tag-image-whitespace3" title="&lt;3/&gt;: 12 tab characters" data-length="12" data-pixellength="0" data-tag-number="3">` +
            `<img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;1&amp;gt;%3C/text%3E%3C/svg%3E" id="tag-image-internal-tag open1" data-length="-1" data-pixellength="0" data-tag-number="1">` +
            `dies` +
            `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="3" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">e Einstellung</span>` +
            `e<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="4" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">n f</span>` +
            `ür de<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="5" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">n Leseberei</span>` +
            `c<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="6" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">h vornehm</span>` +
            `en<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="7" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">, erfahr</span>` +
            `e<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="8" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">n S</span>` +
            `ie i<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="9" data-qtip="&lt;b&gt;Press Ctrl+R&lt;/b&gt; to select proposals or right-click this word. Cursor has to be inside error.">n dies</span>` +
            `er Lerneinheit.<img class="internal-tag close" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/1&amp;gt;%3C/text%3E%3C/svg%3E" alt="&lt;/g&gt;" id="tag-image-internal-tag close1" title="&lt;/g&gt;" data-length="-1" data-pixellength="0" data-tag-number="1">` +
            `<img class="internal-tag single whitespace newline" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2210%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%B5%3C/text%3E%3C/svg%3E" alt="↵" id="tag-image-whitespace4" title="&lt;4/&gt;: Newline" data-length="1" data-pixellength="0" data-tag-number="4">` +
            `<img class="internal-tag single whitespace" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%22191%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%3C/text%3E%3C/svg%3E" alt="→→→→→→→→→→→" id="tag-image-whitespace5" title="&lt;5/&gt;: 11 tab characters" data-length="11" data-pixellength="0" data-tag-number="5">` +
            `</ins>`;
        const div = document.querySelector('ins');
        const [left, right] = splitNode(div, 10);
        expect(left.outerHTML).toBe(
            `<ins class="trackchanges ownttip" data-usertrackingid="3786" data-usercssnr="usernr1" data-workflowstep="no workflow1" data-timestamp="2025-08-27T12:56:05+03:00">` +
            `<img class="internal-tag single whitespace newline" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2210%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%B5%3C/text%3E%3C/svg%3E" alt="↵" id="tag-image-whitespace2" title="<2/>: Newline" data-length="1" data-pixellength="0" data-tag-number="2">` +
            `Wi` +
            `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="1" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">e S</span>` +
            `ie ` +
            `<img class="internal-tag single whitespace" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%22208%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%3C/text%3E%3C/svg%3E" alt="→→→→→→→→→→→→" id="tag-image-whitespace3" title="<3/>: 12 tab characters" data-length="12" data-pixellength="0" data-tag-number="3">` +
            `</ins>`
        );

        const expectedRight = document.createElement('div');
        expectedRight.innerHTML = `<ins class="trackchanges ownttip" data-usertrackingid="3786" data-usercssnr="usernr1" data-workflowstep="no workflow1" data-timestamp="2025-08-27T12:56:05+03:00">` +
            `<img class="internal-tag open" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2230%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;1&amp;gt;%3C/text%3E%3C/svg%3E" id="tag-image-internal-tag open1" data-length="-1" data-pixellength="0" data-tag-number="1">` +
            `dies` +
            `<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="3" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">e Einstellung</span>` +
            `e<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="4" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">n f</span>` +
            `ür de<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="5" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">n Leseberei</span>` +
            `c<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="6" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">h vornehm</span>` +
            `en<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="7" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">, erfahr</span>` +
            `e<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="8" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">n S</span>` +
            `ie i<span class="t5spellcheck t5misspelling ownttip" data-spellcheck-activematchindex="9" data-qtip="<b>Press Ctrl+R</b> to select proposals or right-click this word. Cursor has to be inside error.">n dies</span>` +
            `er Lerneinheit.<img class="internal-tag close" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2236%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E&amp;lt;/1&amp;gt;%3C/text%3E%3C/svg%3E" alt="</g>" id="tag-image-internal-tag close1" title="</g>" data-length="-1" data-pixellength="0" data-tag-number="1">` +
            `<img class="internal-tag single whitespace newline" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%2210%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%B5%3C/text%3E%3C/svg%3E" alt="↵" id="tag-image-whitespace4" title="<4/>: Newline" data-length="1" data-pixellength="0" data-tag-number="4">` +
            `<img class="internal-tag single whitespace" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20height=%2223%22%20width=%22191%22%3E%3Crect%20width=%22100%25%22%20height=%22100%25%22%20fill=%22rgb(207,207,207)%22%20rx=%223%22%20ry=%223%22/%3E%3Ctext%20x=%221%22%20y=%2218%22%20font-size=%2217.3333px%22%20font-weight=%22300%22%20font-family=%22'Open%20Sans',%20'Helvetica%20Neue',%20helvetica,%20arial,%20verdana,%20sans-serif%22%3E%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%E2%86%92%3C/text%3E%3C/svg%3E" alt="→→→→→→→→→→→" id="tag-image-whitespace5" title="<5/>: 11 tab characters" data-length="11" data-pixellength="0" data-tag-number="5">` +
            `</ins>`;
        expect(right).toStrictEqual(
            expectedRight.firstChild
        );
    });
});
