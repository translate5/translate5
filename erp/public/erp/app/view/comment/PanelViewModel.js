/*
 * File: app/view/comment/PanelViewModel.js
 *
 * This file was generated by Sencha Architect
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Erp.view.comment.PanelViewModel', {
    extend: 'Ext.app.ViewModel',
    alias: 'viewmodel.commentpanel',

    requires: [
        'Ext.data.Store',
        'Ext.util.Sorter',
        'Erp.model.project.Comment',
        'Erp.model.purchaseOrder.Comment'
    ],

    initConfig: function(instanceConfig) {
        var me = this,
            config = {
                data: {
                    commentText: ''
                },
                stores: {
                    comments: me.processComments({
                        remoteFilter: true,
                        model: 'Erp.model.CommentBase',
                        sorters: {
                            direction: 'DESC',
                            property: 'id'
                        }
                    })
                }
            };
        if (instanceConfig) {
            me.self.getConfigurator().merge(me, config, instanceConfig);
        }
        return me.callParent([config]);
    },

    processComments: function(config) {
        if(this.context.type == 'order') {
            config.model = 'Erp.model.project.Comment';
        }
        else {
            config.model = 'Erp.model.purchaseOrder.Comment';
        }
        return config;
    },

    constructor: function(config) {
        this.context = config.context;
        this.callParent(arguments);
    }

});